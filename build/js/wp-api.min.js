!function(a){"use strict";var b="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","backbone","exports"],function(c,d,e,f){b.Backbone=a(b,f,c,d,e)});else if("undefined"!=typeof exports){var c=require("underscore"),d=require("jquery"),e=require("backbone");a(b,exports,c,d,e)}else b.Backbone=a(b,{},b._,b.jQuery||b.Zepto||b.ender||b.$,b.Backbone)}(function(a,b,c,d,e){var f;return"undefined"==typeof a.wpApiSettings&&(f=a.wpApiSettings={}),function(a,b,c){"use strict";function d(){this.models={},this.collections={},this.views={}}a.wp=b||{},b.api=b.api||new d,b.api.versionString=b.api.versionString||"wp/v2/"}(a,b),function(a,d){"use strict";var e,f;a.wp=a.wp||{},b.api=b.api||{},b.api.utils=b.api.utils||{},Date.prototype.toISOString||(e=function(a){return f=String(a),1===f.length&&(f="0"+f),f},Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),b.api.utils.parseISO8601=function(a){var b,c,e,f,g=0,h=[1,4,5,6,7,10,11];if(c=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(a)){for(e=0;f=h[e];++e)c[f]=+c[f]||0;c[2]=(+c[2]||1)-1,c[3]=+c[3]||1,"Z"!==c[8]&&d!==c[9]&&(g=60*c[10]+c[11],"+"===c[9]&&(g=0-g)),b=Date.UTC(c[1],c[2],c[3],c[4],c[5]+g,c[6],c[7])}else b=Date.parse?Date.parse(a):NaN;return b},b.api.utils.getRootUrl=function(){return a.location.origin?a.location.origin+"/":a.location.protocol+"/"+a.location.host+"/"},b.api.utils.capitalize=function(a){return c.isUndefined(a)?a:a.charAt(0).toUpperCase()+a.slice(1)},b.api.utils.extractRoutePart=function(a,d){var e;return d=d||1,a=a.replace(b.api.versionString,""),e=a.split("/").reverse(),c.isUndefined(e[--d])?"":e[d]},b.api.utils.extractParentName=function(a){var b,c=a.lastIndexOf("_id>[\\d]+)/");return 0>c?"":(b=a.substr(0,c-1),b=b.split("/"),b.pop(),b=b.pop())}}(a),function(a,b,d,e,f){"use strict";a.api.WPApiBaseModel=d.Model.extend({sync:function(a,e,f){var g;return f=f||{},c.isUndefined(b.nonce)||c.isNull(b.nonce)||(g=f.beforeSend,f.beforeSend=function(a){return a.setRequestHeader("X-WP-Nonce",b.nonce),g?g.apply(this,arguments):void 0}),this.requireForceForDelete&&"delete"===a&&(e.url=e.url()+"?force=true"),d.sync(a,e,f)},save:function(a,b){return c.contains(this.methods,"PUT")||c.contains(this.methods,"POST")?d.Model.prototype.save.call(this,a,b):!1},destroy:function(a){return c.contains(this.methods,"DELETE")?d.Model.prototype.destroy.call(this,a):!1}}),a.api.models.Schema=a.api.WPApiBaseModel.extend({defaults:{_links:{},namespace:null,routes:{}},initialize:function(c,d){var e=this;d=d||{},a.api.WPApiBaseModel.prototype.initialize.call(e,c,d),e.apiRoot=d.apiRoot||b.root,e.versionString=d.versionString||b.versionString},url:function(){return this.apiRoot+this.versionString}})}(b,f,e,a),function(a,b,c,d,e,f){"use strict";a.api.WPApiBaseCollection=c.Collection.extend({initialize:function(a,b){this.state={data:{},currentPage:null,totalPages:null,totalObjects:null},d.isUndefined(b)?this.parent="":this.parent=b.parent},sync:function(a,e,f){var g,h,i=this;return f=f||{},g=f.beforeSend,"undefined"!=typeof b.nonce&&(f.beforeSend=function(a){return a.setRequestHeader("X-WP-Nonce",b.nonce),g?g.apply(i,arguments):void 0}),"read"===a&&(f.data?(i.state.data=d.clone(f.data),delete i.state.data.page):i.state.data=f.data={},"undefined"==typeof f.data.page?(i.state.currentPage=null,i.state.totalPages=null,i.state.totalObjects=null):i.state.currentPage=f.data.page-1,h=f.success,f.success=function(a,b,c){return i.state.totalPages=parseInt(c.getResponseHeader("x-wp-totalpages"),10),i.state.totalObjects=parseInt(c.getResponseHeader("x-wp-total"),10),null===i.state.currentPage?i.state.currentPage=1:i.state.currentPage++,h?h.apply(this,arguments):void 0}),c.sync(a,e,f)},more:function(a){if(a=a||{},a.data=a.data||{},d.extend(a.data,this.state.data),"undefined"==typeof a.data.page){if(!this.hasMore())return!1;null===this.state.currentPage||this.state.currentPage<=1?a.data.page=2:a.data.page=this.state.currentPage+1}return this.fetch(a)},hasMore:function(){return null===this.state.totalPages||null===this.state.totalObjects||null===this.state.currentPage?null:this.state.currentPage<this.state.totalPages}})}(b,f,e,c,a),function(a,d,g){"use strict";var h,i={};a.wp=a.wp||{},b.api=b.api||{},h=e.Model.extend({defaults:{apiRoot:f.root,versionString:b.api.versionString,schema:null,models:{},collections:{}},initialize:function(){var a,f=this;e.Model.prototype.initialize.apply(f,arguments),a=d.Deferred(),f.schemaConstructed=a.promise(),f.schemaModel=new b.api.models.Schema(null,{apiRoot:f.get("apiRoot"),versionString:f.get("versionString")}),f.schemaModel.once("change",function(){f.constructFromSchema(),a.resolve(f)}),f.get("schema")?f.schemaModel.set(f.schemaModel.parse(f.get("schema"))):!c.isUndefined(sessionStorage)&&sessionStorage.getItem("wp-api-schema-model"+f.get("apiRoot")+f.get("versionString"))?f.schemaModel.set(f.schemaModel.parse(JSON.parse(sessionStorage.getItem("wp-api-schema-model"+f.get("apiRoot")+f.get("versionString"))))):f.schemaModel.fetch({success:function(a){c.isUndefined(sessionStorage)||sessionStorage.setItem("wp-api-schema-model"+f.get("apiRoot")+f.get("versionString"),JSON.stringify(a))},error:function(){}})},constructFromSchema:function(){var a,d,e,g,h=this,i=f.mapping||{models:{Categories:"Category",Comments:"Comment",Pages:"Page",PagesMeta:"PageMeta",PagesRevisions:"PageRevision",Posts:"Post",PostsCategories:"PostCategory",PostsRevisions:"PostRevision",PostsTags:"PostTag",Schema:"Schema",Statuses:"Status",Tags:"Tag",Taxonomies:"Taxonomy",Types:"Type",Users:"User"},collections:{PagesMeta:"PageMeta",PagesRevisions:"PageRevisions",PostsCategories:"PostCategories",PostsMeta:"PostMeta",PostsRevisions:"PostRevisions",PostsTags:"PostTags"}};a=[],d=[],e=h.get("apiRoot").replace(b.api.utils.getRootUrl(),""),g={},g.models=h.get("models"),g.collections=h.get("collections"),c.each(h.schemaModel.get("routes"),function(b,c){c!==h.get(" versionString")&&c!==e&&c!=="/"+h.get("versionString").slice(0,-1)&&(c.endsWith("+)")?a.push({index:c,route:b}):c.endsWith("me")||d.push({index:c,route:b}))}),c.each(a,function(a){var d,e=b.api.utils.extractRoutePart(a.index,2),f=b.api.utils.extractRoutePart(a.index,4);""!==f&&f!==e?(d=b.api.utils.capitalize(f)+b.api.utils.capitalize(e),d=i.models[d]||d,g.models[d]=b.api.WPApiBaseModel.extend({url:function(){var a=h.get("apiRoot")+h.get("versionString")+f+"/"+(c.isUndefined(this.get("parent"))||0===this.get("parent")?this.get("parent_post"):this.get("parent"))+"/"+e;return c.isUndefined(this.get("id"))||(a+="/"+this.get("id")),a},route:a,name:d,methods:a.route.methods,initialize:function(){"Posts"!==this.name&&"Pages"!==this.name&&c.contains(this.methods,"DELETE")&&(this.requireForceForDelete=!0)}})):(d=b.api.utils.capitalize(e),d=i.models[d]||d,g.models[d]=b.api.WPApiBaseModel.extend({url:function(){var a=h.get("apiRoot")+h.get("versionString")+e;return c.isUndefined(this.get("id"))||(a+="/"+this.get("id")),a},route:a,name:d,methods:a.route.methods})),b.api.decorateFromRoute(a.route.endpoints,g.models[d])}),c.each(d,function(a){var c,d,e=a.index.slice(a.index.lastIndexOf("/")+1),f=b.api.utils.extractRoutePart(a.index,3);""!==f&&f!==e?(c=b.api.utils.capitalize(f)+b.api.utils.capitalize(e),d=i.models[c]||c,c=i.collections[c]||c,g.collections[c]=b.api.WPApiBaseCollection.extend({url:function(){return h.get("apiRoot")+h.get("versionString")+f+"/"+this.parent+"/"+e},model:g.models[d],name:c,route:a,methods:a.route.methods})):(c=b.api.utils.capitalize(e),d=i.models[c]||c,c=i.collections[c]||c,g.collections[c]=b.api.WPApiBaseCollection.extend({url:h.get("apiRoot")+h.get("versionString")+e,model:g.models[d],name:c,route:a,methods:a.route.methods})),b.api.decorateFromRoute(a.route.endpoints,g.collections[c])}),c.each(g.models,function(a,c){g.models[c]=b.api.addMixinsAndHelpers(a,c,g)})}}),b.api.endpoints=new e.Collection({model:h}),b.api.init=function(a){var e,g,j,k={};return a=a||{},k.apiRoot=a.apiRoot||f.root,k.versionString=a.versionString||f.versionString,k.schema=a.schema||null,k.schema||k.apiRoot!==f.root||k.versionString!==f.versionString||(k.schema=f.schema),i[k.apiRoot+k.versionString]||(e=b.api.endpoints.findWhere({apiRoot:k.apiRoot,versionString:k.versionString}),e||(e=new h(k),b.api.endpoints.add(e)),g=d.Deferred(),j=g.promise(),e.schemaConstructed.done(function(a){b.api.models=c.extend(a.get("models"),b.api.models),b.api.collections=c.extend(a.get("collections"),b.api.collections),g.resolveWith(b.api,[a])}),i[k.apiRoot+k.versionString]=j),i[k.apiRoot+k.versionString]},b.api.addMixinsAndHelpers=function(a,e,f){var g=!1,h=["date","modified","date_gmt","modified_gmt"],i={toJSON:function(){var a=c.clone(this.attributes);return c.each(h,function(b){b in a&&(c.isNull(a[b])||(a[b]=a[b].toISOString()))}),a},parse:function(a){var d;return c.each(h,function(e){e in a&&(c.isNull(a[e])||(d=b.api.utils.parseISO8601(a[e]),a[e]=new Date(d)))}),a}},j={getCategories:function(){var a,e,f,g=this,h="",i="",j=d.Deferred();return a=this.get("id"),e=this.get("_embedded")||{},c.isNumber(a)?(e["https://api.w.org/term"]?i=e["https://api.w.org/term"][0]:h={parent:a},f=new b.api.collections.PostCategories(i,h),c.isUndefined(f.models[0])?f.fetch({success:function(b){g.setCategoryPostParents(b,a),j.resolve(b)}}):(this.setCategoryPostParents(f,a),j.resolve(f)),j.promise()):null},setCategoryPostParents:function(a,b){c.each(a.models,function(a){a.set("parent_post",b)})},setCategories:function(a){var d,e,f=this,g=[];c.isArray(a)?(d=new b.api.collections.Categories,d.fetch({success:function(d){c.each(a,function(a){e=new b.api.models.PostCategories(d.findWhere({slug:a})),e.set("parent_post",f.get("id")),g.push(e)}),a=new b.api.collections.PostCategories(g),f.setCategoriesWithCollection(a)}})):this.setCategoriesWithCollection(a)},setCategoriesWithCollection:function(a){var b,d,e,f;this.getCategories().done(function(g){e=a.pluck("id"),f=g.pluck("id"),d=c.difference(e,f),b=c.difference(f,e),c.each(d,function(b){g.create(a.get(b),{type:"POST"})}),c.each(b,function(a){g.get(a).destroy()})})}},k={getAuthorUser:function(){var a,e,f,g,h;return h=d.Deferred(),e=this.get("author"),f=this.get("_embedded")||{},c.isNumber(e)?(f.author&&(g=c.findWhere(f.author,{id:e})),g||(g={id:e}),a=new b.api.models.User(g),a.get("name")?h.resolve(a):a.fetch({success:function(a){h.resolve(a)}}),h.promise()):null}},l={getFeaturedImage:function(){var a,e,f,g,h;return h=d.Deferred(),e=this.get("featured_image"),f=this.get("_embedded")||{},c.isNumber(e)&&0!==e?(f["https://api.w.org/featuredmedia"]&&(g=c.findWhere(f["https://api.w.org/featuredmedia"],{id:e})),g||(g={id:e}),a=new b.api.models.Media(g),a.get("source_url")?h.resolve(a):a.fetch({success:function(a){h.resolve(a)}}),h.promise()):null}};return c.isUndefined(a.defaults)?a:(c.each(h,function(b){c.isUndefined(a.defaults[b])||(g=!0)}),g&&(a=a.extend(i)),c.isUndefined(a.defaults.author)||(a=a.extend(k)),c.isUndefined(a.defaults.featured_image)||(a=a.extend(l)),c.isUndefined(f.collections[e+"Categories"])||(a=a.extend(j)),a)},b.api.decorateFromRoute=function(a,b){c.each(a,function(a){c.contains(a.methods,"POST")||c.contains(a.methods,"PUT")?c.isEmpty(a.args)||(c.isEmpty(b.defaults)?b.defaults=a.args:b.defaults=c.union(a.args,b.defaults)):c.contains(a.methods,"GET")&&(c.isEmpty(a.args)||(c.isEmpty(b.options)?b.options=a.args:b.options=c.union(a.args,b.options)))}),c.each(b.defaults,function(a,d){c.isUndefined(a["default"])?b.defaults[d]=null:b.defaults[d]=a["default"]})},b.api.init()}(a,d),a.wp});
//# sourceMappingURL=wp-api.min.map